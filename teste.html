<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contagem por QR Code</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity=
    "sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="html5-qrcode.min.js"></script>
  </head>
  <body>
    <main>
        <div id="reader"></div>
        <div id="result"></div>
    </main>
    <button id="botao_finalizar" onclick="finalizar_scanner()" class="btn btn-success">Finalizar</button>
    <script>
        codigo_original = [];
        criando_lista = [];
        contado_somar = [];
        unidades = [];

        
        var lista_de_publicacoes = new Map();
        /*
        lista_de_publicacoes.set('lffi-T', 0)
        lista_de_publicacoes.set('Sentinela Um mundo melhor está próximo', 0)
        console.log(lista_de_publicacoes)
        if(lista_de_publicacoes.has('lffi-T') === true){
          var x = lista_de_publicacoes.get('lffi-T') + 2;
          console.log('Quantidade', x)
        }
        console.log('Publicação', lista_de_publicacoes.has('lffi-T')) 
        console.log('Quantidade', lista_de_publicacoes.get('lffi-T'))
        */
        const scanner = new Html5QrcodeScanner('reader', {
            qrbox: {
                width: 250,
                height: 250,
            },
            fps: 20,
        });

        scanner.render(success, error);
        

      function success(result) {

        var codigo = result.split("#");
        console.log(codigo[1])

        if(codigo[1] == "N0F57O51V" || codigo[1] == "N0F57722Z"){

          codigo_original[0] = "lffi-T";
          console.log(codigo_original[0])

          if(lista_de_publicacoes.has(codigo_original[0]) === true){

            contado_somar[0] = parseInt(prompt("Digite o número de publicações contadas: "))
            unidades[0] = parseInt(lista_de_publicacoes.get(codigo_original[0]) + contado_somar[0]);
            lista_de_publicacoes.set(codigo_original[0], unidades[0]);
            console.log('Quantidade', unidades[0])

          }

          else{

            unidades[0] = parseInt(prompt("Digite o número de publicações contadas: "));
            criando_lista[0] = lista_de_publicacoes.set(codigo_original[0], unidades[0])
            console.log(criando_lista[0])

          }
        }

        else if(codigo[1] == "MGQ27T7QB" || codigo[1] == "MGQ27C72R"){

          codigo_original[1] = "wp21.2-T";
          console.log(codigo_original[1])

          if(lista_de_publicacoes.has(codigo_original[1]) === true){

            contado_somar[1] = parseInt(prompt("Digite o número de publicações contadas: "))
            unidades[1] = parseInt(lista_de_publicacoes.get(codigo_original[1]) + contado_somar[1]);
            lista_de_publicacoes.set(codigo_original[1], unidades[1]);
            console.log('Quantidade', unidades[1])
            console.log(lista_de_publicacoes)
            
          }

          else{

            unidades[1] = parseInt(prompt("Digite o número de publicações contadas: "));
            criando_lista[1] = lista_de_publicacoes.set(codigo_original[1], unidades[1])
            console.log(criando_lista[1])

          }      
        }

        else if(codigo[1] == "PR6DSMR17"){

          codigo_original[2] = "wp23.1-T";
          console.log(codigo_original[2])

          if(lista_de_publicacoes.has(codigo_original[2]) === true){

            contado_somar[2] = parseInt(prompt("Digite o número de publicações contadas: "))
            unidades[2] = parseInt(lista_de_publicacoes.get(codigo_original[2]) + contado_somar[2]);
            lista_de_publicacoes.set(codigo_original[2], unidades[2]);
            console.log('Quantidade', unidades[2])
            console.log(lista_de_publicacoes)
            
          }

          else{

            unidades[2] = parseInt(prompt("Digite o número de publicações contadas: "));
            criando_lista[2] = lista_de_publicacoes.set(codigo_original[2], unidades[2])
            console.log(criando_lista[2])

          }      
        }

        else{

          console.log("Publicação não encontrada no inventário")

        }
        console.log(unidades)
        return unidades; // ou return document.getElementsByClassName(unidades)
      }
               
      function error(err) {
        console.log(err);
      }

      function finalizar_scanner(){

        document.getElementById('botao_finalizar').remove();
        console.log(unidades)
        scanner.clear();
        document.getElementById('reader').remove();
        document.getElementById('result').innerHTML=`
          <div class="container">
            <table class="table table-striped table-bordered">
                <tr>
                    <td>Seja feliz (brochura) = ${unidades[0]} </td>
                    <td>Sentinela 2º 2021 = ${unidades[1]} </td>
                    <td>Sentinela 1º 2023 = ${unidades[2]} </td>
                </tr>
            </table>
          <div>
          `;
      }
    </script>
  </body>
</html>
